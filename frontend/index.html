<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon"
        href='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text x="50%" y="55%" dominant-baseline="middle" text-anchor="middle" style="font-size:50px">üíÉüìö</text></svg>'>
    <title>ËñØË®Ä Playground</title>
    <script src="/monaco-editor/min/vs/loader.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
            margin: 0;
            background-color: #f0f2f5;
            /* Light gray background */
            color: #333;
            /* Darker default text */
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }

        .top-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 40px;
            background-color: #ffffff;
            /* White navbar */
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
            /* Softer shadow for light theme */
            width: 100%;
            box-sizing: border-box;
            flex-shrink: 0;
            height: 10vh;
        }

        .nav-title {
            color: #e83e8c;
            /* Keep brand color */
            margin: 0;
            font-size: 1.8em;
        }

        .nav-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .nav-docs-link {
            font-size: 0.9em;
            color: #555;
            /* Darker gray link */
            text-decoration: none;
            margin: 0;
        }

        .nav-docs-link:hover {
            text-decoration: underline;
            color: #e83e8c;
            /* Brand color on hover */
        }

        .main-layout-container {
            display: flex;
            width: 95%;
            max-width: 1800px;
            height: 85vh;
            margin: 0 auto;
            padding: 10px 0;
            gap: 20px;
            flex-grow: 1;
            overflow: hidden;
            box-sizing: border-box;
        }

        .left-panel,
        .right-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            background-color: #ffffff;
            /* White panels */
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.06);
            /* Softer shadow */
            overflow: hidden;
        }

        .right-panel {
            position: relative;
        }

        .right-panel.hidden {
            display: none;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            /* Darker label text */
        }

        .editor-controls {
            margin-bottom: 10px;
            flex-shrink: 0;
        }

        #editorContainer {
            width: 100%;
            border: 1px solid #d1d5da;
            /* Lighter border */
            border-radius: 4px;
            flex-grow: 1;
            min-height: 150px;
        }

        button#runButton {
            background-color: #e83e8c;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: background-color 0.2s ease;
            width: auto;
            flex-shrink: 0;
        }

        button#runButton:hover {
            background-color: #d63384;
        }

        button#runButton:disabled {
            background-color: #f0a9c9;
            cursor: not-allowed;
        }

        #outputContainer {
            width: 100%;
            display: flex;
            flex-direction: column;
            flex-grow: 1;
            min-height: 0;
        }

        pre#outputArea {
            background-color: #f8f9fa;
            /* Very light gray for output */
            color: #212529;
            /* Dark text for output - default color */
            padding: 15px;
            border-radius: 4px;
            border: 1px solid #d1d5da;
            /* Lighter border */
            white-space: pre-wrap;
            word-wrap: break-word;
            font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace;
            font-size: 14px;
            line-height: 1.5;
            flex-grow: 1;
            overflow-y: auto;
        }

        /* Corrected .error style for specificity */
        pre#outputArea.error {
            color: #c82333;
            /* Red for errors */
            font-weight: bold;
            /* Ensure bold font for errors */
        }

        footer {
            text-align: center;
            padding: 5px;
            font-size: 0.8em;
            color: #555;
            /* Darker gray footer text */
            width: 100%;
            box-sizing: border-box;
            background-color: #f0f2f5;
            /* Match body background */
            flex-shrink: 0;
            height: 5vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        footer p {
            margin: 0;
        }

        #closeRightPanelButton {
            position: absolute;
            top: 10px;
            right: 15px;
            background: none;
            border: none;
            font-size: 1.5em;
            color: #888;
            /* Lighter gray for close icon */
            cursor: pointer;
            padding: 0 5px;
        }

        #closeRightPanelButton:hover {
            color: #333;
            /* Darker on hover */
        }

        /* ÊñáÊ°£ÂºπÁ™óÊ†∑Âºè */
        .doc-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            animation: fadeIn 0.3s ease-out;
        }

        .doc-modal.show {
            display: block;
        }

        .doc-modal-content {
            background-color: #ffffff;
            margin: 2% auto;
            padding: 0;
            border-radius: 8px;
            width: 90%;
            max-width: 1000px;
            height: 90%;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            animation: slideIn 0.3s ease-out;
        }

        .doc-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 25px;
            border-bottom: 1px solid #e0e0e0;
            background-color: #f8f9fa;
            border-radius: 8px 8px 0 0;
        }

        .doc-modal-title {
            margin: 0;
            color: #e83e8c;
            font-size: 1.5em;
        }

        .doc-close-button {
            background: none;
            border: none;
            font-size: 28px;
            color: #888;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s ease;
        }

        .doc-close-button:hover {
            background-color: #f0f0f0;
            color: #333;
        }

        .doc-modal-body {
            padding: 25px;
            flex-grow: 1;
            overflow-y: auto;
            color: #333;
            line-height: 1.6;
        }

        .doc-loading {
            text-align: center;
            padding: 50px;
            color: #666;
            font-size: 1.1em;
        }

        .doc-error {
            text-align: center;
            padding: 50px;
            color: #c82333;
            font-size: 1.1em;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes slideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        /* ÂìçÂ∫îÂºèËÆæËÆ° */
        @media (max-width: 768px) {
            .doc-modal-content {
                width: 95%;
                height: 95%;
                margin: 2.5% auto;
            }

            .doc-modal-header {
                padding: 15px 20px;
            }

            .doc-modal-body {
                padding: 20px;
            }
        }
    </style>
</head>

<body>
    <nav class="top-nav">
        <h2 class="nav-title">ËñØË®Ä Playground üíÉüìö</h2>
        <div class="nav-actions">
            <a class="nav-docs-link" href="/doc">Êü•ÁúãËñØË®ÄÊñáÊ°£</a>
            <button id="runButton">üíÖ ËøêË°å‰ª£Á†Å!</button>
        </div>
    </nav>

    <div class="main-layout-container">
        <div class="left-panel">
            <div id="editorContainer"></div>
        </div>

        <div class="right-panel hidden" id="rightPanelContainer">
            <button id="closeRightPanelButton" title="ÂÖ≥Èó≠">&times;</button>
            <div id="outputContainer">
                <label for="outputArea">ËøêË°åÁªìÊûú:</label>
                <pre id="outputArea">ÁÇπÂáª "ËøêË°å‰ª£Á†Å!" ÊåâÈíÆÊù•Êü•ÁúãÁªìÊûú ‚ú®</pre>
            </div>
        </div>
    </div>

    <footer>
        <p>Ê≥®ÊÑè: Ê≠§ Playground ‰ªÖ‰æõÂ≠¶‰π†ÂíåÊµãËØï„ÄÇËØ∑ÂãøËøêË°å‰∏çÂèØ‰ø°‰ª£Á†Å„ÄÇ</p>
    </footer>

    <!-- ÊñáÊ°£ÂºπÁ™ó -->
    <div id="docModal" class="doc-modal">
        <div class="doc-modal-content">
            <div class="doc-modal-header">
                <h3 class="doc-modal-title">ËñØË®ÄÊñáÊ°£ üìö</h3>
                <button id="docCloseButton" class="doc-close-button" title="ÂÖ≥Èó≠">&times;</button>
            </div>
            <div class="doc-modal-body" id="docModalBody">
                <div class="doc-loading">Ê≠£Âú®Âä†ËΩΩÊñáÊ°£... ‚è≥</div>
            </div>
        </div>
    </div>

    <script>
        let editor;
        const initialCode = `
# RedbookLang (ËñØË®Ä) Êù•‰∫Ü! yyds!

Âê¨ÊàëËØ¥, '--- Âü∫Á°ÄÂèòÈáèÂíåÊâìÂç∞ ---'
ÁßçËçâ‰∏Ä‰∏™ "ÊàëÁöÑÊòµÁß∞" ÊòØ 'ËñØÊù°ÂÆùÂÆù'
ÁßçËçâ‰∏Ä‰∏™ "Âπ∏ËøêÊï∞Â≠ó" ÊòØ -7 # ÂÆö‰πâË¥üÊï∞
Âê¨ÊàëËØ¥, "ÊàëÁöÑÊòµÁß∞", 'ÁöÑÂπ∏ËøêÊï∞Â≠óÊòØ', "Âπ∏ËøêÊï∞Â≠ó"

Âê¨ÊàëËØ¥, '--- ÂáΩÊï∞ÂÆö‰πâ‰∏éË∞ÉÁî® ---'
ÂºÄ‰∏™Êñ∞Â∏ñ Âè´ "Âà∂‰ΩúÂÖÉÊ∞îÊó©È§ê" ËâæÁâπ ("‰∏ªÈ£ü", "È•ÆÂìÅ"):
    ÁªùÁªùÂ≠ê 'ÂÖÉÊ∞îÊó©È§êÂ∑≤‰∏äÁ∫øÔºö' Âä†‰∏ä "‰∏ªÈ£ü" Âä†‰∏ä ' + ' Âä†‰∏ä "È•ÆÂìÅ" Âä†‰∏ä 'ÔºåÂºÄÂêØÁæéÂ•Ω‰∏ÄÂ§©ÔºÅ‚òÄÔ∏è'

ÁßçËçâ‰∏Ä‰∏™ "ÊàëÁöÑÊó©È§ê" ÊòØ Ë∞ÉÁî® "Âà∂‰ΩúÂÖÉÊ∞îÊó©È§ê" Áî® ('Â∞èÈù¢ÂåÖ', 'ÁáïÈ∫¶ÊãøÈìÅ')
Âê¨ÊàëËØ¥, "ÊàëÁöÑÊó©È§ê"

Âê¨ÊàëËØ¥, '--- Êù°‰ª∂ËØ≠Âè•ÔºöÂ∫∑Â∫∑ÊòØ‰∏çÊòØ ---'
ÁßçËçâ‰∏Ä‰∏™ "Á¨îËÆ∞ÁÇπËµûÊï∞" ÊòØ 250
Â∫∑Â∫∑ÊòØ‰∏çÊòØ "Á¨îËÆ∞ÁÇπËµûÊï∞" Â§ß‰∫é 500 Âπ∂‰∏î "Âπ∏ËøêÊï∞Â≠ó" Â∞è‰∫é 0:
    Âê¨ÊàëËØ¥, 'ÂìáÂì¶ÔºÅÁ¨îËÆ∞Â∞èÁàÜÊ¨æÔºåËÄå‰∏î‰ªäÂ§©Âπ∏ËøêÂÄºÊãâÊª°ÔºÅ'
ÊàñËÄÖÂ∫∑Â∫∑ "Á¨îËÆ∞ÁÇπËµûÊï∞" Â§ß‰∫é 200:
    Âê¨ÊàëËØ¥, '‰∏çÈîôÂì¶ÔºåÁ¨îËÆ∞Êúâ‰∫∫Ê∞îÔºåÁªßÁª≠Âä†Ê≤πÔºÅ' # <--- ËøôÊù°‰ºöÊâßË°å
ÈÉΩ‰∏çÊòØÂë¢:
    Âê¨ÊàëËØ¥, 'Ê≤°ÂÖ≥Á≥ªÔºåÊØèÁØáÁî®ÂøÉÂàÜ‰∫´ÁöÑÁ¨îËÆ∞ÈÉΩÊòØÂ•ΩÁ¨îËÆ∞ÔºÅüíñ'

Â∫∑Â∫∑ÊòØ‰∏çÊòØ ÂèçËΩ¨È≠ÖÂäõ ("Á¨îËÆ∞ÁÇπËµûÊï∞" Á≠â‰∫é 0): # not (ÁÇπËµû == 0) -> ÁÇπËµû != 0
    Âê¨ÊàëËØ¥, 'Á¨îËÆ∞Â∑≤ÁªèÊúâËµûÂï¶Ôºå‰∏çÊòØÈõ∂ËõãÂÆùÂÆùÔºÅ'

Âê¨ÊàëËØ¥, '--- Âæ™ÁéØÔºöÊú¨ÂÆùÂÆùÂùöÊåÅ ---'
ÁßçËçâ‰∏Ä‰∏™ "ÊØèÊó•ÁõÆÊ†áÊ≠•Êï∞" ÊòØ 3
ÁßçËçâ‰∏Ä‰∏™ "Â∑≤Ëµ∞Ê≠•Êï∞" ÊòØ 0
ÂºÄ‰∏™Êñ∞Â∏ñ Âè´ "Ëµ∞‰∏ÄÊ≠•" ËâæÁâπ ("ÂΩìÂâçÊ≠•Êï∞"):
    ÁªùÁªùÂ≠ê "ÂΩìÂâçÊ≠•Êï∞" Âä†‰∏ä 1

Êú¨ÂÆùÂÆùÂùöÊåÅ "Â∑≤Ëµ∞Ê≠•Êï∞" Â∞è‰∫é "ÊØèÊó•ÁõÆÊ†áÊ≠•Êï∞":
    ÁßçËçâ‰∏Ä‰∏™ "Â∑≤Ëµ∞Ê≠•Êï∞" ÊòØ Ë∞ÉÁî® "Ëµ∞‰∏ÄÊ≠•" Áî® ("Â∑≤Ëµ∞Ê≠•Êï∞")

Âê¨ÊàëËØ¥, '‰ªäÊó•ËøêÂä®KPIÂÆåÊàêÔºåÂÖ±Ëµ∞', "Â∑≤Ëµ∞Ê≠•Êï∞", 'Ê≠•!üèÉ‚Äç‚ôÄÔ∏è'

Âê¨ÊàëËØ¥, '--- Âæ™ÁéØÔºöÁõòÁÇπÊ∏ÖÂçï (ÊîØÊåÅË¥üÊï∞ÂíåË¥üÊ≠•Èïø) ---'
ÂºÄ‰∏™Êñ∞Â∏ñ Âè´ "ÂàÜ‰∫´Á¨¨N‰∏™ËçâÁ®ø" ËâæÁâπ ("ËçâÁ®øÂ∫èÂè∑"):
    Âê¨ÊàëËØ¥, 'Ê≠£Âú®ÁºñËæëÁ¨¨', "ËçâÁ®øÂ∫èÂè∑", '‰∏™ËçâÁ®øÔºåÂø´Ë¶ÅÂÆåÊàê‰∫ÜÔºÅ'

Âê¨ÊàëËØ¥, '* Ê≠£ÂêëÁõòÁÇπ *'
ÁõòÁÇπÊ∏ÖÂçï "ËçâÁ®øID" (ÂêØÂä®: 1, ÁõÆÊ†á: 4): # ËçâÁ®øID: 1, 2, 3
    Ë∞ÉÁî® "ÂàÜ‰∫´Á¨¨N‰∏™ËçâÁ®ø" Áî® ("ËçâÁ®øID")

Âê¨ÊàëËØ¥, '* ÂèçÂêëÁõòÁÇπ *'
ÁõòÁÇπÊ∏ÖÂçï "ÂÄíÊï∞Êó•" (ÂêØÂä®: 3, ÁõÆÊ†á: 0, Ë∑®Ê≠•: -1): # ÂÄíÊï∞Êó•: 3, 2, 1
    Âê¨ÊàëËØ¥, 'Ë∑ùÁ¶ª deadline ËøòÊúâ:', "ÂÄíÊï∞Êó•", 'Â§©! ÂÜ≤Âà∫ÔºÅ'

ÁßçËçâ‰∏Ä‰∏™ "ÊàëÁöÑËµ∑ÁÇπ" ÊòØ -2
ÁßçËçâ‰∏Ä‰∏™ "ÊàëÁöÑÁªàÁÇπ" ÊòØ 3
ÁßçËçâ‰∏Ä‰∏™ "ÊàëÁöÑÊ≠•Ë∞É" ÊòØ 1
ÁõòÁÇπÊ∏ÖÂçï "Ë¥üÊï∞ÊµãËØï" (ÂêØÂä®: "ÊàëÁöÑËµ∑ÁÇπ", ÁõÆÊ†á: "ÊàëÁöÑÁªàÁÇπ", Ë∑®Ê≠•: "ÊàëÁöÑÊ≠•Ë∞É"): # -2, -1, 0, 1, 2
    Âê¨ÊàëËØ¥, 'Ë¥üÊï∞Âæ™ÁéØÊµãËØïÂÄº:', "Ë¥üÊï∞ÊµãËØï"

Âê¨ÊàëËØ¥, '--- Â∏ÉÂ∞î‰∏éÈÄªËæë ---'
ÁßçËçâ‰∏Ä‰∏™ "‰ªäÂ§©‰∏ãÈõ®" ÊòØ Êâç‰∏çÊòØ
ÁßçËçâ‰∏Ä‰∏™ "Âë®Êú´" ÊòØ ÂΩìÁÑ∂Âï¶
Â∫∑Â∫∑ÊòØ‰∏çÊòØ "‰ªäÂ§©‰∏ãÈõ®" ÊàñËÄÖ ÂèçËΩ¨È≠ÖÂäõ "Âë®Êú´": # false or not(true) -> false or false -> false
    Âê¨ÊàëËØ¥, 'ÂùèÂ§©Ê∞îÔºåÂÆÖÂÆ∂Âà∑ÂâßÂêßÔºÅ'
ÈÉΩ‰∏çÊòØÂë¢: # ËøôÊù°‰ºöÊâßË°å
    Âê¨ÊàëËØ¥, 'Â§©Ê∞î‰∏çÈîôÔºåÊàñËÄÖÂ∞±ÊòØÂë®Êú´ÔºåÂá∫ÂéªÁé©ÔºÅ'

Âê¨ÊàëËØ¥, '--- ÈîôËØØÂ§ÑÁêÜ ---'
# ËØïËØïÈîôËØØÂ§ÑÁêÜ
ÁßçËçâ‰∏Ä‰∏™ "Á©∫ÁØÆÂ≠ê" ÊòØ 0
# ‰∏ãÈù¢ËøôË°å‰ºöËß¶Âèë ZeroDivisionErrorÔºåÂ¶ÇÊûúÂèñÊ∂àÊ≥®Èáä
# Âê¨ÊàëËØ¥, 100 Èô§‰ª• "Á©∫ÁØÆÂ≠ê"
Âê¨ÊàëËØ¥, '‰ª£Á†ÅÊâßË°åÂÆåÊØïÔºåÊÑüË∞¢‰ΩøÁî®ËñØË®ÄÔºÅ'
`.trim();

        require.config({ paths: { 'vs': '/monaco-editor/min/vs' } });
        require(['vs/editor/editor.main'], function () {
            monaco.languages.register({ id: 'shuyan' });

            const shuyanKeywordsCore = [
                'ÁßçËçâ‰∏Ä‰∏™', 'ÊòØ', 'Âê¨ÊàëËØ¥', 'ÂºÄ‰∏™Êñ∞Â∏ñ', 'Ë∞ÉÁî®', 'Âè´', 'ËâæÁâπ', 'Áî®', 'ÁªùÁªùÂ≠ê',
                'Â∫∑Â∫∑ÊòØ‰∏çÊòØ', 'ÊàñËÄÖÂ∫∑Â∫∑', 'ÈÉΩ‰∏çÊòØÂë¢', 'Êú¨ÂÆùÂÆùÂùöÊåÅ', 'ÁõòÁÇπÊ∏ÖÂçï',
                'ÂèçËΩ¨È≠ÖÂäõ'
            ];
            const shuyanBooleanLiterals = ['ÂΩìÁÑ∂Âï¶', 'Êâç‰∏çÊòØ'];
            const shuyanOperatorsKeywords = [
                'Âä†‰∏ä', 'ÂáèÂéª', '‰πò‰ª•', 'Èô§‰ª•',
                'Á≠â‰∫é', '‰∏çÁ≠â‰∫é', 'Â∞è‰∫é', 'Â∞è‰∫éÁ≠â‰∫é', 'Â§ß‰∫é', 'Â§ß‰∫éÁ≠â‰∫é',
                'Âπ∂‰∏î', 'ÊàñËÄÖ'
            ];
            const shuyanForParamsKeywords = ['ÂêØÂä®:', 'ÁõÆÊ†á:', 'Ë∑®Ê≠•:'];

            monaco.languages.setMonarchTokensProvider('shuyan', {
                keywords: shuyanKeywordsCore,
                typeKeywords: shuyanBooleanLiterals,
                operators: shuyanOperatorsKeywords,
                paramKeywords: shuyanForParamsKeywords,

                tokenizer: {
                    root: [
                        [/"[^"]*"/, 'identifier.shuyan'],
                        [/'[^']*'/, 'string.shuyan'],
                        { include: '@whitespace' },
                        [/#.*$/, 'comment.shuyan'],
                        [/\d*\.\d+([eE][\-+]?\d+)?/, 'number.float.shuyan'],
                        [/\d+([eE][\-+]?\d+)?/, 'number.shuyan'],
                        [new RegExp(shuyanKeywordsCore.join('|')), 'keyword.shuyan'],
                        [new RegExp(shuyanBooleanLiterals.join('|')), 'typeKeyword.shuyan'],
                        [new RegExp(shuyanOperatorsKeywords.join('|')), 'operator.shuyan'],
                        [/ÂêØÂä®:|ÁõÆÊ†á:|Ë∑®Ê≠•:/, 'paramKeyword.shuyan'],
                        [/[()]/, 'delimiter.parenthesis.shuyan'],
                        [/,/, 'delimiter.comma.shuyan'],
                        [/:/, 'delimiter.colon.shuyan'],
                        [/-/, 'operator.symbol.shuyan']
                    ],
                    whitespace: [
                        [/[ \t\r\n]+/, ''],
                    ],
                }
            });

            monaco.editor.defineTheme('shuyanTheme', {
                base: 'vs', // Base changed to 'vs' for light theme
                inherit: true,
                rules: [
                    { token: 'keyword.shuyan', foreground: '7928A1', fontStyle: 'bold' }, /* Dark Blue/Purple */
                    { token: 'identifier.shuyan', foreground: '333333' }, /* Dark Gray */
                    { token: 'string.shuyan', foreground: '008000' }, /* Dark Green */
                    { token: 'number.shuyan', foreground: '098658' }, /* Teal / Dark Cyan */
                    { token: 'number.float.shuyan', foreground: '098658' }, /* Teal / Dark Cyan */
                    { token: 'comment.shuyan', foreground: '808080', fontStyle: 'italic' }, /* Gray */
                    { token: 'operator.shuyan', foreground: '445588' }, /* Darker Blue/Gray */
                    { token: 'operator.symbol.shuyan', foreground: '445588' }, /* Darker Blue/Gray */
                    { token: 'typeKeyword.shuyan', foreground: 'BF5B00' }, /* Dark Orange for booleans */
                    { token: 'paramKeyword.shuyan', foreground: 'A31515', fontStyle: 'bold' }, /* Dark Red */
                    { token: 'delimiter.parenthesis.shuyan', foreground: '666666' }, /* Medium Gray */
                    { token: 'delimiter.comma.shuyan', foreground: '666666' }, /* Medium Gray */
                    { token: 'delimiter.colon.shuyan', foreground: '666666' }  /* Medium Gray */
                ],
                colors: {
                    'editor.foreground': '#333333', /* Dark gray text */
                    'editor.background': '#FFFFFF', /* White editor background */
                    'editorCursor.foreground': '#e83e8c', /* Brand pink cursor for visibility */
                    'editor.lineHighlightBackground': '#EFEFEF', /* Very light gray for line highlight */
                    'editorLineNumber.foreground': '#AAAAAA', /* Medium gray for line numbers */
                    'editor.selectionBackground': '#E8D9EF', /* Light Pink/Lavender selection */
                    'editorWidget.background': '#F3F3F3', /* Background for widgets like find/replace */
                    'editorWidget.border': '#DCDCDC'      /* Border for editor widgets */
                }
            });

            editor = monaco.editor.create(document.getElementById('editorContainer'), {
                value: initialCode,
                language: 'shuyan',
                theme: 'shuyanTheme', // Apply the new light theme
                automaticLayout: true,
                fontSize: 14,
                lineNumbers: 'on',
                roundedSelection: false,
                scrollBeyondLastLine: false,
                readOnly: false,
                minimap: { enabled: true }
            });

            const runButton = document.getElementById('runButton');
            const outputArea = document.getElementById('outputArea');
            const rightPanelContainer = document.getElementById('rightPanelContainer');
            const closeRightPanelButton = document.getElementById('closeRightPanelButton');

            // ÊñáÊ°£ÂºπÁ™óÁõ∏ÂÖ≥ÂÖÉÁ¥†
            const docModal = document.getElementById('docModal');
            const docModalBody = document.getElementById('docModalBody');
            const docCloseButton = document.getElementById('docCloseButton');
            const docLink = document.querySelector('.nav-docs-link');

            runButton.addEventListener('click', async () => {
                rightPanelContainer.classList.remove('hidden');

                const code = editor.getValue();
                outputArea.textContent = 'ËøêË°å‰∏≠... ‚è≥';
                outputArea.classList.remove('error'); // Remove error class at the start
                runButton.disabled = true;

                try {
                    // Replace '/run' with your actual API endpoint if different
                    const response = await fetch('/run', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ code: code })
                    });

                    const result = await response.json();

                    if (response.ok) {
                        let displayText = "";
                        if (result.output) {
                            displayText += result.output;
                        }
                        if (result.error) {
                            displayText += (displayText ? "\n\n---üíÖ Oops! ÈîôËØØ‰ø°ÊÅØÊù•Âï¶---\n" : "---üíÖ Oops! ÈîôËØØ‰ø°ÊÅØÊù•Âï¶---\n") + result.error;
                            outputArea.classList.add('error'); // Add error class if error
                        }
                        outputArea.textContent = displayText || 'ÊâßË°åÂÆåÊØïÔºå‰ΩÜÂ•ΩÂÉèÊ≤°‰ªÄ‰πàË¶ÅËæìÂá∫ÁöÑÂë¢ ü§î';
                    } else {
                        outputArea.textContent = `ËØ∑Ê±ÇÈîôËØØ: ${response.status}\n${result.error || 'Á≥üÁ≥ïÔºåÂêéÁ´ØÂ•ΩÂÉèÂºÄÂ∞èÂ∑Æ‰∫ÜÔºÅ'}`;
                        outputArea.classList.add('error'); // Add error class if HTTP error
                    }

                } catch (err) {
                    outputArea.textContent = 'ÂÆ¢Êà∑Á´ØÂá∫ÈîôÂï¶: ' + err.message + 'ÔºåÂ∫∑Â∫∑ÁΩëÁªúÊàñËÄÖÊéßÂà∂Âè∞Ôºü';
                    outputArea.classList.add('error'); // Add error class if client-side fetch error
                } finally {
                    runButton.disabled = false;
                    outputArea.scrollTop = outputArea.scrollHeight;
                }
            });

            closeRightPanelButton.addEventListener('click', () => {
                rightPanelContainer.classList.add('hidden');
            });

            // ÊñáÊ°£ÂºπÁ™óÂäüËÉΩ
            async function loadDocumentation() {
                docModal.classList.add('show');
                docModalBody.innerHTML = '<div class="doc-loading">Ê≠£Âú®Âä†ËΩΩÊñáÊ°£... ‚è≥</div>';

                try {
                    const response = await fetch('/doc');

                    if (response.ok) {
                        const docHtml = await response.text();
                        docModalBody.innerHTML = docHtml;
                    } else {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                } catch (error) {
                    console.error('Âä†ËΩΩÊñáÊ°£Â§±Ë¥•:', error);
                    docModalBody.innerHTML = `
                        <div class="doc-error">
                            üíî ÊñáÊ°£Âä†ËΩΩÂ§±Ë¥•<br>
                            ÈîôËØØ‰ø°ÊÅØ: ${error.message}<br>
                            <small>ËØ∑Ê£ÄÊü•ÁΩëÁªúËøûÊé•ÊàñËÅîÁ≥ªÁÆ°ÁêÜÂëò</small>
                        </div>
                    `;
                }
            }

            function closeDocModal() {
                docModal.classList.remove('show');
            }

            // ÁÇπÂáªÊñáÊ°£ÈìæÊé•Êó∂ÈòªÊ≠¢ÈªòËÆ§Ë∑≥ËΩ¨Âπ∂ÊâìÂºÄÂºπÁ™ó
            docLink.addEventListener('click', (e) => {
                e.preventDefault();
                loadDocumentation();
            });

            // ÂÖ≥Èó≠ÊåâÈíÆ‰∫ã‰ª∂
            docCloseButton.addEventListener('click', closeDocModal);

            // ÁÇπÂáªÂºπÁ™óËÉåÊôØÂÖ≥Èó≠
            docModal.addEventListener('click', (e) => {
                if (e.target === docModal) {
                    closeDocModal();
                }
            });

            // ESC ÈîÆÂÖ≥Èó≠ÂºπÁ™ó
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && docModal.classList.contains('show')) {
                    closeDocModal();
                }
            });
        });
    </script>
</body>

</html>
