<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon"
        href='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text x="50%" y="55%" dominant-baseline="middle" text-anchor="middle" style="font-size:50px">ğŸ’ƒğŸ“š</text></svg>'>
    <title>è–¯è¨€ Playground</title>
    <script src="/monaco-editor/min/vs/loader.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
            margin: 0;
            background-color: #f0f2f5;
            /* Light gray background */
            color: #333;
            /* Darker default text */
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }

        .top-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 40px;
            background-color: #ffffff;
            /* White navbar */
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
            /* Softer shadow for light theme */
            width: 100%;
            box-sizing: border-box;
            flex-shrink: 0;
            height: 10vh;
        }

        .nav-title {
            color: #e83e8c;
            /* Keep brand color */
            margin: 0;
            font-size: 1.8em;
        }

        .nav-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .nav-docs-link {
            font-size: 0.9em;
            color: #555;
            /* Darker gray link */
            text-decoration: none;
            margin: 0;
        }

        .nav-docs-link:hover {
            text-decoration: underline;
            color: #e83e8c;
            /* Brand color on hover */
        }

        .main-layout-container {
            display: flex;
            width: 95%;
            max-width: 1800px;
            height: 85vh;
            margin: 0 auto;
            padding: 10px 0;
            gap: 20px;
            flex-grow: 1;
            overflow: hidden;
            box-sizing: border-box;
        }

        .left-panel,
        .right-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            background-color: #ffffff;
            /* White panels */
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.06);
            /* Softer shadow */
            overflow: hidden;
        }

        .right-panel {
            position: relative;
        }

        .right-panel.hidden {
            display: none;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            /* Darker label text */
        }

        .editor-controls {
            margin-bottom: 10px;
            flex-shrink: 0;
        }

        #editorContainer {
            width: 100%;
            border: 1px solid #d1d5da;
            /* Lighter border */
            border-radius: 4px;
            flex-grow: 1;
            min-height: 150px;
        }

        button#runButton {
            background-color: #e83e8c;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: background-color 0.2s ease;
            width: auto;
            flex-shrink: 0;
        }

        button#runButton:hover {
            background-color: #d63384;
        }

        button#runButton:disabled {
            background-color: #f0a9c9;
            cursor: not-allowed;
        }

        #outputContainer {
            width: 100%;
            display: flex;
            flex-direction: column;
            flex-grow: 1;
            min-height: 0;
        }

        pre#outputArea {
            background-color: #f8f9fa;
            /* Very light gray for output */
            color: #212529;
            /* Dark text for output - default color */
            padding: 15px;
            border-radius: 4px;
            border: 1px solid #d1d5da;
            /* Lighter border */
            white-space: pre-wrap;
            word-wrap: break-word;
            font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace;
            font-size: 14px;
            line-height: 1.5;
            flex-grow: 1;
            overflow-y: auto;
        }

        /* Corrected .error style for specificity */
        pre#outputArea.error {
            color: #c82333;
            /* Red for errors */
            font-weight: bold;
            /* Ensure bold font for errors */
        }

        footer {
            text-align: center;
            padding: 5px;
            font-size: 0.8em;
            color: #555;
            /* Darker gray footer text */
            width: 100%;
            box-sizing: border-box;
            background-color: #f0f2f5;
            /* Match body background */
            flex-shrink: 0;
            height: 5vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        footer p {
            margin: 0;
        }

        #closeRightPanelButton {
            position: absolute;
            top: 10px;
            right: 15px;
            background: none;
            border: none;
            font-size: 1.5em;
            color: #888;
            /* Lighter gray for close icon */
            cursor: pointer;
            padding: 0 5px;
        }

        #closeRightPanelButton:hover {
            color: #333;
            /* Darker on hover */
        }

        /* æ–‡æ¡£å¼¹çª—æ ·å¼ */
        .doc-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            animation: fadeIn 0.3s ease-out;
        }

        .doc-modal.show {
            display: block;
        }

        .doc-modal-content {
            background-color: #ffffff;
            margin: 2% auto;
            padding: 0;
            border-radius: 8px;
            width: 90%;
            max-width: 1000px;
            height: 90%;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            animation: slideIn 0.3s ease-out;
        }

        .doc-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 25px;
            border-bottom: 1px solid #e0e0e0;
            background-color: #f8f9fa;
            border-radius: 8px 8px 0 0;
        }

        .doc-modal-title {
            margin: 0;
            color: #e83e8c;
            font-size: 1.5em;
        }

        .doc-close-button {
            background: none;
            border: none;
            font-size: 28px;
            color: #888;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s ease;
        }

        .doc-close-button:hover {
            background-color: #f0f0f0;
            color: #333;
        }

        .doc-modal-body {
            padding: 25px;
            flex-grow: 1;
            overflow-y: auto;
            color: #333;
            line-height: 1.6;
        }

        .doc-loading {
            text-align: center;
            padding: 50px;
            color: #666;
            font-size: 1.1em;
        }

        .doc-error {
            text-align: center;
            padding: 50px;
            color: #c82333;
            font-size: 1.1em;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes slideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .doc-modal-content {
                width: 95%;
                height: 95%;
                margin: 2.5% auto;
            }

            .doc-modal-header {
                padding: 15px 20px;
            }

            .doc-modal-body {
                padding: 20px;
            }
        }
    </style>
</head>

<body>
    <nav class="top-nav">
        <h2 class="nav-title">è–¯è¨€ Playground ğŸ’ƒğŸ“š</h2>
        <div class="nav-actions">
            <a class="nav-docs-link" href="/doc">æŸ¥çœ‹è–¯è¨€æ–‡æ¡£</a>
            <button id="runButton">ğŸ’… è¿è¡Œä»£ç !</button>
        </div>
    </nav>

    <div class="main-layout-container">
        <div class="left-panel">
            <div id="editorContainer"></div>
        </div>

        <div class="right-panel hidden" id="rightPanelContainer">
            <button id="closeRightPanelButton" title="å…³é—­">&times;</button>
            <div id="outputContainer">
                <label for="outputArea">è¿è¡Œç»“æœ:</label>
                <pre id="outputArea">ç‚¹å‡» "è¿è¡Œä»£ç !" æŒ‰é’®æ¥æŸ¥çœ‹ç»“æœ âœ¨</pre>
            </div>
        </div>
    </div>

    <footer>
        <p>æ³¨æ„: æ­¤ Playground ä»…ä¾›å­¦ä¹ å’Œæµ‹è¯•ã€‚è¯·å‹¿è¿è¡Œä¸å¯ä¿¡ä»£ç ã€‚</p>
    </footer>

    <!-- æ–‡æ¡£å¼¹çª— -->
    <div id="docModal" class="doc-modal">
        <div class="doc-modal-content">
            <div class="doc-modal-header">
                <h3 class="doc-modal-title">è–¯è¨€æ–‡æ¡£ ğŸ“š</h3>
                <button id="docCloseButton" class="doc-close-button" title="å…³é—­">&times;</button>
            </div>
            <div class="doc-modal-body" id="docModalBody">
                <div class="doc-loading">æ­£åœ¨åŠ è½½æ–‡æ¡£... â³</div>
            </div>
        </div>
    </div>

    <script>
        let editor;
        const initialCode = `
# RedbookLang (è–¯è¨€) æ¥äº†! yyds!

å¬æˆ‘è¯´, '--- åŸºç¡€å˜é‡å’Œæ‰“å° ---'
ç§è‰ä¸€ä¸ª "æˆ‘çš„æ˜µç§°" æ˜¯ 'è–¯æ¡å®å®'
ç§è‰ä¸€ä¸ª "å¹¸è¿æ•°å­—" æ˜¯ -7 # å®šä¹‰è´Ÿæ•°
å¬æˆ‘è¯´, "æˆ‘çš„æ˜µç§°", 'çš„å¹¸è¿æ•°å­—æ˜¯', "å¹¸è¿æ•°å­—"

å¬æˆ‘è¯´, '--- å‡½æ•°å®šä¹‰ä¸è°ƒç”¨ ---'
å¼€ä¸ªæ–°å¸– å« "åˆ¶ä½œå…ƒæ°”æ—©é¤" è‰¾ç‰¹ ("ä¸»é£Ÿ", "é¥®å“"):
    ç»ç»å­ 'å…ƒæ°”æ—©é¤å·²ä¸Šçº¿ï¼š' åŠ ä¸Š "ä¸»é£Ÿ" åŠ ä¸Š ' + ' åŠ ä¸Š "é¥®å“" åŠ ä¸Š 'ï¼Œå¼€å¯ç¾å¥½ä¸€å¤©ï¼â˜€ï¸'

ç§è‰ä¸€ä¸ª "æˆ‘çš„æ—©é¤" æ˜¯ è°ƒç”¨ "åˆ¶ä½œå…ƒæ°”æ—©é¤" ç”¨ ('å°é¢åŒ…', 'ç‡•éº¦æ‹¿é“')
å¬æˆ‘è¯´, "æˆ‘çš„æ—©é¤"

å¬æˆ‘è¯´, '--- æ¡ä»¶è¯­å¥ï¼šåº·åº·æ˜¯ä¸æ˜¯ ---'
ç§è‰ä¸€ä¸ª "ç¬”è®°ç‚¹èµæ•°" æ˜¯ 250
åº·åº·æ˜¯ä¸æ˜¯ "ç¬”è®°ç‚¹èµæ•°" å¤§äº 500 å¹¶ä¸” "å¹¸è¿æ•°å­—" å°äº 0:
    å¬æˆ‘è¯´, 'å“‡å“¦ï¼ç¬”è®°å°çˆ†æ¬¾ï¼Œè€Œä¸”ä»Šå¤©å¹¸è¿å€¼æ‹‰æ»¡ï¼'
æˆ–è€…åº·åº· "ç¬”è®°ç‚¹èµæ•°" å¤§äº 200:
    å¬æˆ‘è¯´, 'ä¸é”™å“¦ï¼Œç¬”è®°æœ‰äººæ°”ï¼Œç»§ç»­åŠ æ²¹ï¼' # <--- è¿™æ¡ä¼šæ‰§è¡Œ
éƒ½ä¸æ˜¯å‘¢:
    å¬æˆ‘è¯´, 'æ²¡å…³ç³»ï¼Œæ¯ç¯‡ç”¨å¿ƒåˆ†äº«çš„ç¬”è®°éƒ½æ˜¯å¥½ç¬”è®°ï¼ğŸ’–'

åº·åº·æ˜¯ä¸æ˜¯ åè½¬é­…åŠ› ("ç¬”è®°ç‚¹èµæ•°" ç­‰äº 0): # not (ç‚¹èµ == 0) -> ç‚¹èµ != 0
    å¬æˆ‘è¯´, 'ç¬”è®°å·²ç»æœ‰èµå•¦ï¼Œä¸æ˜¯é›¶è›‹å®å®ï¼'

å¬æˆ‘è¯´, '--- å¾ªç¯ï¼šæœ¬å®å®åšæŒ ---'
ç§è‰ä¸€ä¸ª "æ¯æ—¥ç›®æ ‡æ­¥æ•°" æ˜¯ 3
ç§è‰ä¸€ä¸ª "å·²èµ°æ­¥æ•°" æ˜¯ 0
å¼€ä¸ªæ–°å¸– å« "èµ°ä¸€æ­¥" è‰¾ç‰¹ ("å½“å‰æ­¥æ•°"):
    ç»ç»å­ "å½“å‰æ­¥æ•°" åŠ ä¸Š 1

æœ¬å®å®åšæŒ "å·²èµ°æ­¥æ•°" å°äº "æ¯æ—¥ç›®æ ‡æ­¥æ•°":
    ç§è‰ä¸€ä¸ª "å·²èµ°æ­¥æ•°" æ˜¯ è°ƒç”¨ "èµ°ä¸€æ­¥" ç”¨ ("å·²èµ°æ­¥æ•°")

å¬æˆ‘è¯´, 'ä»Šæ—¥è¿åŠ¨KPIå®Œæˆï¼Œå…±èµ°', "å·²èµ°æ­¥æ•°", 'æ­¥!ğŸƒâ€â™€ï¸'

å¬æˆ‘è¯´, '--- å¾ªç¯ï¼šç›˜ç‚¹æ¸…å• (æ”¯æŒè´Ÿæ•°å’Œè´Ÿæ­¥é•¿) ---'
å¼€ä¸ªæ–°å¸– å« "åˆ†äº«ç¬¬Nä¸ªè‰ç¨¿" è‰¾ç‰¹ ("è‰ç¨¿åºå·"):
    å¬æˆ‘è¯´, 'æ­£åœ¨ç¼–è¾‘ç¬¬', "è‰ç¨¿åºå·", 'ä¸ªè‰ç¨¿ï¼Œå¿«è¦å®Œæˆäº†ï¼'

å¬æˆ‘è¯´, '* æ­£å‘ç›˜ç‚¹ *'
ç›˜ç‚¹æ¸…å• "è‰ç¨¿ID" (å¯åŠ¨: 1, ç›®æ ‡: 4): # è‰ç¨¿ID: 1, 2, 3
    è°ƒç”¨ "åˆ†äº«ç¬¬Nä¸ªè‰ç¨¿" ç”¨ ("è‰ç¨¿ID")

å¬æˆ‘è¯´, '* åå‘ç›˜ç‚¹ *'
ç›˜ç‚¹æ¸…å• "å€’æ•°æ—¥" (å¯åŠ¨: 3, ç›®æ ‡: 0, è·¨æ­¥: -1): # å€’æ•°æ—¥: 3, 2, 1
    å¬æˆ‘è¯´, 'è·ç¦» deadline è¿˜æœ‰:', "å€’æ•°æ—¥", 'å¤©! å†²åˆºï¼'

ç§è‰ä¸€ä¸ª "æˆ‘çš„èµ·ç‚¹" æ˜¯ -2
ç§è‰ä¸€ä¸ª "æˆ‘çš„ç»ˆç‚¹" æ˜¯ 3
ç§è‰ä¸€ä¸ª "æˆ‘çš„æ­¥è°ƒ" æ˜¯ 1
ç›˜ç‚¹æ¸…å• "è´Ÿæ•°æµ‹è¯•" (å¯åŠ¨: "æˆ‘çš„èµ·ç‚¹", ç›®æ ‡: "æˆ‘çš„ç»ˆç‚¹", è·¨æ­¥: "æˆ‘çš„æ­¥è°ƒ"): # -2, -1, 0, 1, 2
    å¬æˆ‘è¯´, 'è´Ÿæ•°å¾ªç¯æµ‹è¯•å€¼:', "è´Ÿæ•°æµ‹è¯•"

å¬æˆ‘è¯´, '--- å¸ƒå°”ä¸é€»è¾‘ ---'
ç§è‰ä¸€ä¸ª "ä»Šå¤©ä¸‹é›¨" æ˜¯ æ‰ä¸æ˜¯
ç§è‰ä¸€ä¸ª "å‘¨æœ«" æ˜¯ å½“ç„¶å•¦
åº·åº·æ˜¯ä¸æ˜¯ "ä»Šå¤©ä¸‹é›¨" æˆ–è€… åè½¬é­…åŠ› "å‘¨æœ«": # false or not(true) -> false or false -> false
    å¬æˆ‘è¯´, 'åå¤©æ°”ï¼Œå®…å®¶åˆ·å‰§å§ï¼'
éƒ½ä¸æ˜¯å‘¢: # è¿™æ¡ä¼šæ‰§è¡Œ
    å¬æˆ‘è¯´, 'å¤©æ°”ä¸é”™ï¼Œæˆ–è€…å°±æ˜¯å‘¨æœ«ï¼Œå‡ºå»ç©ï¼'

å¬æˆ‘è¯´, '--- é”™è¯¯å¤„ç† ---'
# è¯•è¯•é”™è¯¯å¤„ç†
ç§è‰ä¸€ä¸ª "ç©ºç¯®å­" æ˜¯ 0
# ä¸‹é¢è¿™è¡Œä¼šè§¦å‘ ZeroDivisionErrorï¼Œå¦‚æœå–æ¶ˆæ³¨é‡Š
# å¬æˆ‘è¯´, 100 é™¤ä»¥ "ç©ºç¯®å­"
å¬æˆ‘è¯´, 'ä»£ç æ‰§è¡Œå®Œæ¯•ï¼Œæ„Ÿè°¢ä½¿ç”¨è–¯è¨€ï¼'
`.trim();

        require.config({ paths: { 'vs': '/monaco-editor/min/vs' } });
        require(['vs/editor/editor.main'], function () {
            monaco.languages.register({ id: 'shuyan' });

            const shuyanKeywordsCore = [
                'ç§è‰ä¸€ä¸ª', 'æ˜¯', 'å¬æˆ‘è¯´', 'å¼€ä¸ªæ–°å¸–', 'è°ƒç”¨', 'å«', 'è‰¾ç‰¹', 'ç”¨', 'ç»ç»å­',
                'åº·åº·æ˜¯ä¸æ˜¯', 'æˆ–è€…åº·åº·', 'éƒ½ä¸æ˜¯å‘¢', 'æœ¬å®å®åšæŒ', 'ç›˜ç‚¹æ¸…å•',
                'åè½¬é­…åŠ›'
            ];
            const shuyanBooleanLiterals = ['å½“ç„¶å•¦', 'æ‰ä¸æ˜¯'];
            const shuyanOperatorsKeywords = [
                'åŠ ä¸Š', 'å‡å»', 'ä¹˜ä»¥', 'é™¤ä»¥',
                'ç­‰äº', 'ä¸ç­‰äº', 'å°äº', 'å°äºç­‰äº', 'å¤§äº', 'å¤§äºç­‰äº',
                'å¹¶ä¸”', 'æˆ–è€…'
            ];
            const shuyanForParamsKeywords = ['å¯åŠ¨:', 'ç›®æ ‡:', 'è·¨æ­¥:'];

            monaco.languages.setMonarchTokensProvider('shuyan', {
                keywords: shuyanKeywordsCore,
                typeKeywords: shuyanBooleanLiterals,
                operators: shuyanOperatorsKeywords,
                paramKeywords: shuyanForParamsKeywords,

                tokenizer: {
                    root: [
                        [/"[^"]*"/, 'identifier.shuyan'],
                        [/'[^']*'/, 'string.shuyan'],
                        { include: '@whitespace' },
                        [/#.*$/, 'comment.shuyan'],
                        [/\d*\.\d+([eE][\-+]?\d+)?/, 'number.float.shuyan'],
                        [/\d+([eE][\-+]?\d+)?/, 'number.shuyan'],
                        [new RegExp(shuyanKeywordsCore.join('|')), 'keyword.shuyan'],
                        [new RegExp(shuyanBooleanLiterals.join('|')), 'typeKeyword.shuyan'],
                        [new RegExp(shuyanOperatorsKeywords.join('|')), 'operator.shuyan'],
                        [/å¯åŠ¨:|ç›®æ ‡:|è·¨æ­¥:/, 'paramKeyword.shuyan'],
                        [/[()]/, 'delimiter.parenthesis.shuyan'],
                        [/,/, 'delimiter.comma.shuyan'],
                        [/:/, 'delimiter.colon.shuyan'],
                        [/-/, 'operator.symbol.shuyan']
                    ],
                    whitespace: [
                        [/[ \t\r\n]+/, ''],
                    ],
                }
            });

            monaco.editor.defineTheme('shuyanTheme', {
                base: 'vs', // Base changed to 'vs' for light theme
                inherit: true,
                rules: [
                    { token: 'keyword.shuyan', foreground: '7928A1', fontStyle: 'bold' }, /* Dark Blue/Purple */
                    { token: 'identifier.shuyan', foreground: '333333' }, /* Dark Gray */
                    { token: 'string.shuyan', foreground: '008000' }, /* Dark Green */
                    { token: 'number.shuyan', foreground: '098658' }, /* Teal / Dark Cyan */
                    { token: 'number.float.shuyan', foreground: '098658' }, /* Teal / Dark Cyan */
                    { token: 'comment.shuyan', foreground: '808080', fontStyle: 'italic' }, /* Gray */
                    { token: 'operator.shuyan', foreground: '445588' }, /* Darker Blue/Gray */
                    { token: 'operator.symbol.shuyan', foreground: '445588' }, /* Darker Blue/Gray */
                    { token: 'typeKeyword.shuyan', foreground: 'BF5B00' }, /* Dark Orange for booleans */
                    { token: 'paramKeyword.shuyan', foreground: 'A31515', fontStyle: 'bold' }, /* Dark Red */
                    { token: 'delimiter.parenthesis.shuyan', foreground: '666666' }, /* Medium Gray */
                    { token: 'delimiter.comma.shuyan', foreground: '666666' }, /* Medium Gray */
                    { token: 'delimiter.colon.shuyan', foreground: '666666' }  /* Medium Gray */
                ],
                colors: {
                    'editor.foreground': '#333333', /* Dark gray text */
                    'editor.background': '#FFFFFF', /* White editor background */
                    'editorCursor.foreground': '#e83e8c', /* Brand pink cursor for visibility */
                    'editor.lineHighlightBackground': '#EFEFEF', /* Very light gray for line highlight */
                    'editorLineNumber.foreground': '#AAAAAA', /* Medium gray for line numbers */
                    'editor.selectionBackground': '#E8D9EF', /* Light Pink/Lavender selection */
                    'editorWidget.background': '#F3F3F3', /* Background for widgets like find/replace */
                    'editorWidget.border': '#DCDCDC'      /* Border for editor widgets */
                }
            });

            editor = monaco.editor.create(document.getElementById('editorContainer'), {
                value: initialCode,
                language: 'shuyan',
                theme: 'shuyanTheme', // Apply the new light theme
                automaticLayout: true,
                fontSize: 14,
                lineNumbers: 'on',
                roundedSelection: false,
                scrollBeyondLastLine: false,
                readOnly: false,
                minimap: { enabled: true }
            });

            const runButton = document.getElementById('runButton');
            const outputArea = document.getElementById('outputArea');
            const rightPanelContainer = document.getElementById('rightPanelContainer');
            const closeRightPanelButton = document.getElementById('closeRightPanelButton');

            // æ–‡æ¡£å¼¹çª—ç›¸å…³å…ƒç´ 
            const docModal = document.getElementById('docModal');
            const docModalBody = document.getElementById('docModalBody');
            const docCloseButton = document.getElementById('docCloseButton');
            const docLink = document.querySelector('.nav-docs-link');

            runButton.addEventListener('click', async () => {
                rightPanelContainer.classList.remove('hidden');

                const code = editor.getValue();
                outputArea.textContent = 'è¿è¡Œä¸­... â³';
                outputArea.classList.remove('error'); // Remove error class at the start
                runButton.disabled = true;

                try {
                    // Replace '/run' with your actual API endpoint if different
                    const response = await fetch('/run', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ code: code })
                    });

                    const result = await response.json();

                    if (response.ok) {
                        let displayText = "";
                        if (result.output) {
                            displayText += result.output;
                        }
                        if (result.error) {
                            displayText += (displayText ? "\n\n---ğŸ’… Oops! é”™è¯¯ä¿¡æ¯æ¥å•¦---\n" : "---ğŸ’… Oops! é”™è¯¯ä¿¡æ¯æ¥å•¦---\n") + result.error;
                            outputArea.classList.add('error'); // Add error class if error
                        }
                        outputArea.textContent = displayText || 'æ‰§è¡Œå®Œæ¯•ï¼Œä½†å¥½åƒæ²¡ä»€ä¹ˆè¦è¾“å‡ºçš„å‘¢ ğŸ¤”';
                    } else {
                        outputArea.textContent = `è¯·æ±‚é”™è¯¯: ${response.status}\n${result.error || 'ç³Ÿç³•ï¼Œåç«¯å¥½åƒå¼€å°å·®äº†ï¼'}`;
                        outputArea.classList.add('error'); // Add error class if HTTP error
                    }

                } catch (err) {
                    outputArea.textContent = 'å®¢æˆ·ç«¯å‡ºé”™å•¦: ' + err.message + 'ï¼Œåº·åº·ç½‘ç»œæˆ–è€…æ§åˆ¶å°ï¼Ÿ';
                    outputArea.classList.add('error'); // Add error class if client-side fetch error
                } finally {
                    runButton.disabled = false;
                    outputArea.scrollTop = outputArea.scrollHeight;
                }
            });

            closeRightPanelButton.addEventListener('click', () => {
                rightPanelContainer.classList.add('hidden');
            });

            // æ–‡æ¡£å¼¹çª—åŠŸèƒ½
            async function loadDocumentation() {
                docModal.classList.add('show');
                docModalBody.innerHTML = '<div class="doc-loading">æ­£åœ¨åŠ è½½æ–‡æ¡£... â³</div>';

                try {
                    const response = await fetch('/doc');

                    if (response.ok) {
                        const docHtml = await response.text();
                        docModalBody.innerHTML = docHtml;
                    } else {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                } catch (error) {
                    console.error('åŠ è½½æ–‡æ¡£å¤±è´¥:', error);
                    docModalBody.innerHTML = `
                        <div class="doc-error">
                            ğŸ’” æ–‡æ¡£åŠ è½½å¤±è´¥<br>
                            é”™è¯¯ä¿¡æ¯: ${error.message}<br>
                            <small>è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–è”ç³»ç®¡ç†å‘˜</small>
                        </div>
                    `;
                }
            }

            function closeDocModal() {
                docModal.classList.remove('show');
            }

            // ç‚¹å‡»æ–‡æ¡£é“¾æ¥æ—¶é˜»æ­¢é»˜è®¤è·³è½¬å¹¶æ‰“å¼€å¼¹çª—
            docLink.addEventListener('click', (e) => {
                e.preventDefault();
                loadDocumentation();
            });

            // å…³é—­æŒ‰é’®äº‹ä»¶
            docCloseButton.addEventListener('click', closeDocModal);

            // ç‚¹å‡»å¼¹çª—èƒŒæ™¯å…³é—­
            docModal.addEventListener('click', (e) => {
                if (e.target === docModal) {
                    closeDocModal();
                }
            });

            // ESC é”®å…³é—­å¼¹çª—
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && docModal.classList.contains('show')) {
                    closeDocModal();
                }
            });
        });
    </script>
</body>

</html>
